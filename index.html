<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Horas Extras</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --accent-color: #e74c3c;
            --light-color: #f9f9f9;
            --dark-color: #34495e;
            --saturday-color: #9b59b6;
            --sunday-color: #e67e22;
            --holiday-color: #f1c40f;
            --normal-hours-color: #2ecc71;
            --group1-color: #3498db;
            --group2-color: #9b59b6;
            --double-day-color: #ff6b6b;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        /* ANIMACIONES */
        @keyframes fadeInUp {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        @keyframes highlightChange {
            0% { background-color: #fffbcc; }
            100% { background-color: transparent; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* Animaci√≥n general al cargar */
        .container {
            animation: fadeInUp 0.8s ease-in-out;
        }

        header {
            text-align: center;
            padding: 30px;
            background: linear-gradient(270deg, var(--dark-color), #2c3e50, var(--primary-color));
            background-size: 600% 600%;
            color: white;
            animation: gradientShift 10s ease infinite;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        h1 {
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .app-description {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .form-section, .results-section {
            flex: 1;
            min-width: 300px;
            padding: 25px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .form-title, .results-title, .history-title {
            position: relative;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
        }
        .form-title::after, .results-title::after, .history-title::after {
            content: '';
            position: absolute;
            width: 0%;
            height: 3px;
            left: 0;
            bottom: -4px;
            background-color: var(--primary-color);
            transition: width 0.5s ease;
        }
        .form-title:hover::after,
        .results-title:hover::after,
        .history-title:hover::after {
            width: 100%;
        }

        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s, transform 0.3s, box-shadow 0.3s;
        }
        
        input:focus, select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.4);
            transform: scale(1.01);
        }
        
        .checkbox-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
            flex: 1;
            min-width: 200px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .checkbox-item:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .checkbox-item input[type="radio"] {
            width: auto;
            margin-right: 10px;
        }
        
        .group-label {
            display: block;
            font-size: 0.85rem;
            color: #666;
            margin-top: 4px;
            font-weight: normal;
        }
        
        .group1-label {
            color: var(--group1-color);
        }
        
        .group2-label {
            color: var(--group2-color);
        }
        
        button {
            background: linear-gradient(to right, var(--primary-color), #2980b9);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            animation: pulse 0.5s ease;
        }
        
        .button-secondary {
            background: linear-gradient(to right, var(--secondary-color), #27ae60);
        }
        
        .button-danger {
            background: linear-gradient(to right, var(--accent-color), #c0392b);
        }
        
        .button-warning {
            background: linear-gradient(to right, #f39c12, #e67e22);
        }
        
        .result-card {
            background-color: var(--light-color);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--primary-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .result-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        .normal-hours {
            border-left-color: var(--normal-hours-color);
        }
        
        .overtime-normal {
            border-left-color: var(--group1-color);
        }
        
        .overtime-special {
            border-left-color: var(--sunday-color);
        }
        
        .double-day {
            border-left-color: var(--double-day-color);
        }
        
        .result-card h3 {
            color: var(--dark-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .result-card h3 i {
            margin-right: 10px;
        }
        
        .result-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
            animation: highlightChange 1s ease;
        }
        
        .normal-hours .result-value {
            color: var(--normal-hours-color);
        }
        
        .overtime-normal .result-value {
            color: var(--group1-color);
        }
        
        .overtime-special .result-value {
            color: var(--sunday-color);
        }
        
        .double-day .result-value {
            color: var(--double-day-color);
        }
        
        .result-details {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .summary-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--secondary-color), #27ae60);
            color: white;
            padding: 25px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .summary-text {
            font-size: 1.2rem;
        }
        
        .summary-value {
            font-size: 2.2rem;
            font-weight: bold;
        }
        
        .history-section {
            padding: 25px;
            background: white;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .history-actions {
            display: flex;
            gap: 10px;
        }
        
        .history-actions button {
            width: auto;
            padding: 10px 15px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: var(--dark-color);
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background-color: rgba(52,152,219,0.1);
            transition: background-color 0.3s ease;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .action-buttons button {
            padding: 8px 12px;
            font-size: 14px;
            width: auto;
        }
        
        .info-box {
            background-color: #e3f2fd;
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            font-size: 0.9rem;
        }
        
        .info-box strong {
            display: block;
            margin-bottom: 10px;
            color: var(--dark-color);
        }
        
        .info-box ul {
            padding-left: 20px;
        }
        
        .info-box li {
            margin-bottom: 5px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }
        
        .holiday-label {
            display: inline;
            font-weight: normal;
            color: var(--holiday-color);
        }
        
        .double-day-label {
            display: inline;
            font-weight: normal;
            color: var(--double-day-color);
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: #333;
            color: white;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        .toast.success {
            background-color: var(--secondary-color);
        }
        
        .toast.error {
            background-color: var(--accent-color);
            animation: shake 0.5s ease;
        }
        
        .real-time-results {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid var(--primary-color);
        }
        
        .double-day-info {
            display: none;
            background-color: #fff4f4;
            border-left: 4px solid var(--double-day-color);
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .form-section, .results-section {
                width: 100%;
            }
            
            .checkbox-container {
                flex-direction: column;
            }
            
            .summary-card {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
        }
    </style>
</head>
 
<body>  
    <div class="container">  
        <header>  
            <h1>Calculadora de Horas Extras</h1>  
            <p class="app-description">Registra tus horarios de trabajo y calcula autom√°ticamente tus horas extras seg√∫n los horarios laborales definidos</p>  
        </header>  

        <div class="main-content">  
            <section class="form-section">  
                <h2 class="form-title">Registrar Nuevo Horario</h2>  
                <form id="schedule-form">  
                    <div class="form-group">  
                        <label>Selecciona tu grupo de trabajo:</label>  
                        <div class="checkbox-container">  
                            <div class="checkbox-item">  
                                <input type="radio" id="group1" name="work-group" value="group1" required>  
                                <label for="group1">Grupo 1  
                                    <span class="group-label group1-label">L-V: 7:00am-4:00pm, S: 7:00am-11:00am</span>  
                                </label>  
                            </div>  
                            <div class="checkbox-item">  
                                <input type="radio" id="group2" name="work-group" value="group2">  
                                <label for="group2">Grupo 2  
                                    <span class="group-label group2-label">L-V: 8:00am-5:00pm, S: 8:00am-12:00pm</span>  
                                </label>  
                            </div>  
                        </div>  
                    </div>  
                      
                    <div class="form-group">  
                        <label for="date">Fecha de inicio:</label>  
                        <input type="date" id="date" required>  
                    </div>  
                      
                    <div class="form-group">  
                        <label for="start-time">Hora de inicio:</label>  
                        <input type="time" id="start-time" required>  
                    </div>  
                      
                    <div class="form-group">  
                        <label for="end-date">Fecha de fin (si pasa de un d√≠a a otro):</label>  
                        <input type="date" id="end-date">  
                    </div>  
                      
                    <div class="form-group">  
                        <label for="end-time">Hora de fin:</label>  
                        <input type="time" id="end-time" required>  
                    </div>  
                      
                    <div class="form-group">  
                        <label for="location">Ubicaci√≥n:</label>  
                        <input type="text" id="location" placeholder="Lugar de trabajo" required>  
                    </div>  
                      
                    <div class="form-group">  
                        <div class="checkbox-group">  
                            <input type="checkbox" id="is-holiday">  
                            <label for="is-holiday" class="holiday-label">¬øEs d√≠a festivo/feriado?</label>  
                        </div>  
                    </div>

                    <div class="form-group">  
                        <div class="checkbox-group">  
                            <input type="checkbox" id="is-double-day">  
                            <label for="is-double-day" class="double-day-label">¬øAplicar d√≠a doble?</label>  
                        </div>  
                        <div class="double-day-info" id="double-day-info">
                            <strong>D√≠a doble:</strong> Aplicable solo en domingos y festivos. Las primeras 9 horas se pagan como d√≠a doble (valor configurable), y las horas adicionales como extras especiales.
                        </div>
                    </div>

                    <div class="form-group" id="double-day-rate-group" style="display: none;">  
                        <label for="double-day-rate">Valor del d√≠a doble (Q):</label>  
                        <input type="number" id="double-day-rate" placeholder="Ej: 250.00" min="0" step="0.01">  
                    </div>
                      
                    <div class="form-group">  
                        <label for="description">Descripci√≥n (opcional):</label>  
                        <input type="text" id="description" placeholder="Detalles adicionales">  
                    </div>  
                      
                    <button type="submit">Guardar y Calcular</button>  
                </form>  
                
                <div class="real-time-results">
                    <h3>Previsualizaci√≥n</h3>
                    <p>Horas normales: <span id="preview-normal">0.00</span></p>
                    <p>Horas extras normales: <span id="preview-normal-ot">0.00</span></p>
                    <p>Horas extras especiales: <span id="preview-special-ot">0.00</span></p>
                    <p>D√≠a doble: <span id="preview-double-day">No aplica</span></p>
                    <p>Total estimado: Q<span id="preview-total">0.00</span></p>
                </div>
                  
                <div class="info-box">  
                    <strong>Informaci√≥n importante:</strong>  
                    <ul>  
                        <li><b>Grupo 1:</b> Lunes a Viernes (7:00am - 4:00pm), S√°bado (7:00am - 11:00am)</li>  
                        <li><b>Grupo 2:</b> Lunes a Viernes (8:00am - 5:00pm), S√°bado (8:00am - 12:00pm)</li>  
                        <li>Precio hora extra normal (Lunes 1:00am - S√°bado antes del turno): Q23.00</li>  
                        <li>Precio hora extra especial (S√°bado despu√©s del turno - Domingo 12:00am): Q31.00</li>  
                        <li>Domingos y festivos: todas las horas son extras especiales</li>  
                        <li><b>D√≠a doble:</b> Aplicable solo en domingos y festivos. Las primeras 9 horas se pagan como d√≠a doble, horas adicionales como extras especiales</li>  
                    </ul>  
                </div>  
            </section>  
              
            <section class="results-section">  
                <h2 class="results-title">Resumen de Horas</h2>  
                  
                <div class="result-card normal-hours">  
                    <h3><i>‚è∞</i> Horas Normales Trabajadas</h3>  
                    <div class="result-value" id="normal-hours">0.00 horas</div>  
                    <p class="result-details">Horas dentro del horario regular establecido</p>  
                </div>  
                  
                <div class="result-card overtime-normal">  
                    <h3><i>üìÖ</i> Horas Extras Normales (Q23.00/hora)</h3>  
                    <div class="result-value" id="normal-overtime">0.00 horas</div>  
                    <p class="result-details">Lunes 1:00am - S√°bado antes del turno</p>  
                    <div class="result-value" id="normal-amount">Q0.00</div>  
                </div>  
                  
                <div class="result-card overtime-special">  
                    <h3><i>üìÖ</i> Horas Extras Especiales (Q31.00/hora)</h3>  
                    <div class="result-value" id="special-overtime">0.00 horas</div>  
                    <p class="result-details">S√°bado despu√©s del turno - Domingo 12:00am</p>  
                    <div class="result-value" id="special-amount">Q0.00</div>  
                </div>

                <div class="result-card double-day">  
                    <h3><i>üéØ</i> D√≠as Dobles</h3>  
                    <div class="result-value" id="double-day-count">0 d√≠as</div>  
                    <p class="result-details">Domingos y festivos con d√≠a doble aplicado</p>  
                    <div class="result-value" id="double-day-amount">Q0.00</div>  
                </div>
                  
                <div class="summary-card">  
                    <div class="summary-text">Total a recibir por horas extras:</div>  
                    <div class="summary-value" id="total-amount">Q0.00</div>  
                </div>  
            </section>  
        </div>  
          
        <section class="history-section">  
            <div class="history-header">
                <h2 class="history-title">Historial de Horarios</h2>  
                <div class="history-actions">
                    <button id="export-btn" class="button-secondary">Exportar CSV</button>
                    <button id="clear-btn" class="button-danger">Limpiar Historial</button>
                </div>
            </div>
            <table id="schedule-history">  
                <thead>  
                    <tr>  
                        <th>Grupo</th>  
                        <th>Fecha Inicio</th>  
                        <th>Fecha Fin</th>  
                        <th>Inicio</th>  
                        <th>Fin</th>  
                        <th>Horas Totales</th>  
                        <th>Horas Normales</th>  
                        <th>Horas Extras</th>  
                        <th>D√≠a Doble</th>  
                        <th>Monto Total</th>  
                        <th>Ubicaci√≥n</th>  
                        <th>Acciones</th>  
                    </tr>  
                </thead>  
                <tbody>  
                    <!-- Los registros se insertar√°n aqu√≠ din√°micamente -->  
                </tbody>  
            </table>  
        </section>  
    </div>  

    <div id="toast" class="toast"></div>

    <script>  
        // Precios fijos (solo modificables en el c√≥digo)  
        const NORMAL_OVERTIME_RATE = 23.00; // Q23.00 por hora extra normal  
        const SPECIAL_OVERTIME_RATE = 31.00; // Q31.00 por hora extra especial  
        const DEFAULT_DOUBLE_DAY_RATE = 250.00; // Valor por defecto para d√≠a doble
        const DOUBLE_DAY_HOURS = 9; // Horas que cubre el d√≠a doble
          
        // Lista de d√≠as festivos en Guatemala (puedes agregar m√°s)  
        const GUATEMALA_HOLIDAYS = [  
            '2023-01-01', // A√±o Nuevo  
            '2023-04-06', // Jueves Santo  
            '2023-04-07', // Viernes Santo  
            '2023-05-01', // D√≠a del Trabajo  
            '2023-06-30', // D√≠a del Ej√©rcito  
            '2023-09-15', // D√≠a de la Independencia  
            '2023-10-20', // D√≠a de la Revoluci√≥n  
            '2023-11-01', // D√≠a de Todos los Santos  
            '2023-12-24', // Nochebuena (medio d√≠a)  
            '2023-12-25', // Navidad  
            '2023-12-31', // V√≠spera de A√±o Nuevo (medio d√≠a)  
            // Agrega aqu√≠ m√°s fechas de a√±os siguientes...  
            '2024-01-01', '2024-03-28', '2024-03-29', '2024-05-01', '2024-06-30', 
            '2024-09-15', '2024-10-20', '2024-11-01', '2024-12-24', '2024-12-25', '2024-12-31'
        ];  

        // Horarios laborales definidos para cada grupo (entre semana y s√°bado unidos)  
        const WORK_SCHEDULES = {  
            group1: {  
                weekday: { start: 7, end: 16, duration: 9 }, // L-V: 7:00am - 4:00pm (9 horas incluyendo almuerzo)  
                saturday: { start: 7, end: 11, duration: 4 }  // S√°bado: 7:00am - 11:00am (4 horas)  
            },  
            group2: {  
                weekday: { start: 8, end: 17, duration: 9 }, // L-V: 8:00am - 5:00pm (9 horas incluyendo almuerzo)  
                saturday: { start: 8, end: 12, duration: 4 }  // S√°bado: 8:00am - 12:00pm (4 horas)  
            }  
        };  

        // Variables globales
        let editingIndex = -1;
        let isEditing = false;

        document.addEventListener('DOMContentLoaded', function() {  
            const form = document.getElementById('schedule-form');  
            const historyTable = document.getElementById('schedule-history').querySelector('tbody');  
            const exportBtn = document.getElementById('export-btn');
            const clearBtn = document.getElementById('clear-btn');
            const toast = document.getElementById('toast');
            const isDoubleDayCheckbox = document.getElementById('is-double-day');
            const doubleDayInfo = document.getElementById('double-day-info');
            const doubleDayRateGroup = document.getElementById('double-day-rate-group');
            const dateInput = document.getElementById('date');
              
            // Cargar historial desde localStorage  
            loadHistory();  
            updateOvertimeSummary();  
              
            // Establecer la fecha actual por defecto  
            const today = new Date();  
            const formattedDate = formatDateForInput(today);  
            document.getElementById('date').value = formattedDate;  
            document.getElementById('end-date').value = formattedDate;  
            document.getElementById('double-day-rate').value = DEFAULT_DOUBLE_DAY_RATE.toFixed(2);
            
            // Event listeners para campos del formulario (c√°lculo en tiempo real)
            const formInputs = form.querySelectorAll('input');
            formInputs.forEach(input => {
                input.addEventListener('change', updateRealTimePreview);
                input.addEventListener('input', updateRealTimePreview);
            });
            
            // Event listener para el checkbox de d√≠a doble
            isDoubleDayCheckbox.addEventListener('change', function() {
                if (this.checked) {
                    doubleDayInfo.style.display = 'block';
                    doubleDayRateGroup.style.display = 'block';
                    // Verificar si la fecha seleccionada es domingo o festivo
                    checkDoubleDayEligibility();
                } else {
                    doubleDayInfo.style.display = 'none';
                    doubleDayRateGroup.style.display = 'none';
                }
                updateRealTimePreview();
            });
            
            // Event listener para cambio de fecha
            dateInput.addEventListener('change', function() {
                if (isDoubleDayCheckbox.checked) {
                    checkDoubleDayEligibility();
                }
                updateRealTimePreview();
            });
            
            // Event listener para exportar datos
            exportBtn.addEventListener('click', exportToCSV);
            
            // Event listener para limpiar historial
            clearBtn.addEventListener('click', clearHistory);
              
            form.addEventListener('submit', function(e) {  
                e.preventDefault();  
                  
                const workGroup = document.querySelector('input[name="work-group"]:checked')?.value;  
                const startDate = document.getElementById('date').value;  
                const startTime = document.getElementById('start-time').value;  
                let endDate = document.getElementById('end-date').value;  
                const endTime = document.getElementById('end-time').value;  
                const location = document.getElementById('location').value;  
                const isHoliday = document.getElementById('is-holiday').checked;  
                const isDoubleDay = document.getElementById('is-double-day').checked;  
                const doubleDayRate = parseFloat(document.getElementById('double-day-rate').value) || DEFAULT_DOUBLE_DAY_RATE;  
                const description = document.getElementById('description').value;  
                  
                if (!workGroup || !startDate || !startTime || !endTime || !location) {  
                    showToast('Por favor, complete todos los campos obligatorios.', 'error');
                    return;  
                }  
                  
                // Si no se especifica fecha de fin, usar la misma fecha de inicio  
                if (!endDate) {  
                    endDate = startDate;  
                }  
                  
                // Validar que la fecha de fin no sea anterior a la de inicio
                const startDateTime = new Date(`${startDate}T${startTime}`);
                const endDateTime = new Date(`${endDate}T${endTime}`);
                
                if (endDateTime <= startDateTime) {
                    showToast('La fecha/hora de fin debe ser posterior a la de inicio.', 'error');
                    return;
                }
                
                // Validar d√≠a doble
                if (isDoubleDay && !isDoubleDayEligible(startDate, isHoliday)) {
                    showToast('El d√≠a doble solo aplica para domingos y d√≠as festivos.', 'error');
                    return;
                }
                  
                // Calcular horas trabajadas  
                const { totalHours, normalHours, overtimeHours, doubleDayApplied } = calculateHours(  
                    workGroup, startDate, startTime, endDate, endTime, isHoliday, isDoubleDay  
                );  
                  
                // Calcular montos  
                const normalAmount = overtimeHours.normal * NORMAL_OVERTIME_RATE;  
                const specialAmount = overtimeHours.special * SPECIAL_OVERTIME_RATE;  
                const doubleDayAmount = doubleDayApplied ? doubleDayRate : 0;
                const totalAmount = normalAmount + specialAmount + doubleDayAmount;  
                  
                if (isEditing) {
                    // Actualizar registro existente
                    updateSchedule(
                        editingIndex,
                        workGroup, startDate, endDate, startTime, endTime,   
                        totalHours, normalHours, overtimeHours, doubleDayApplied, doubleDayRate,
                        normalAmount, specialAmount, doubleDayAmount, location, description, isHoliday, isDoubleDay  
                    );
                    showToast('Registro actualizado correctamente.', 'success');
                    isEditing = false;
                    editingIndex = -1;
                    form.querySelector('button[type="submit"]').textContent = 'Guardar y Calcular';
                } else {
                    // Guardar el registro nuevo
                    saveSchedule(  
                        workGroup, startDate, endDate, startTime, endTime,   
                        totalHours, normalHours, overtimeHours, doubleDayApplied, doubleDayRate,
                        normalAmount, specialAmount, doubleDayAmount, location, description, isHoliday, isDoubleDay  
                    );  
                    showToast('Registro guardado correctamente.', 'success');
                }
                  
                // Actualizar la interfaz  
                loadHistory();
                updateOvertimeSummary();  
                  
                // Limpiar el formulario pero mantener las fechas  
                document.getElementById('start-time').value = '';  
                document.getElementById('end-time').value = '';  
                document.getElementById('location').value = '';  
                document.getElementById('description').value = '';  
                document.getElementById('is-holiday').checked = false;  
                document.getElementById('is-double-day').checked = false;
                doubleDayInfo.style.display = 'none';
                doubleDayRateGroup.style.display = 'none';
            });  
              
            function formatDateForInput(date) {  
                const year = date.getFullYear();  
                const month = String(date.getMonth() + 1).padStart(2, '0');  
                const day = String(date.getDate()).padStart(2, '0');  
                return `${year}-${month}-${day}`;  
            }
            
            function isDoubleDayEligible(dateString, isHoliday) {
                const date = new Date(dateString);
                const dayOfWeek = date.getDay();
                return dayOfWeek === 0 || isHoliday || isHolidayDate(dateString);
            }
            
            function checkDoubleDayEligibility() {
                const dateValue = dateInput.value;
                const isHoliday = document.getElementById('is-holiday').checked;
                
                if (!dateValue) return;
                
                if (!isDoubleDayEligible(dateValue, isHoliday)) {
                    showToast('El d√≠a doble solo aplica para domingos y d√≠as festivos.', 'error');
                    document.getElementById('is-double-day').checked = false;
                    doubleDayInfo.style.display = 'none';
                    doubleDayRateGroup.style.display = 'none';
                }
            }
              
            function calculateHours(workGroup, startDate, startTime, endDate, endTime, isHoliday, isDoubleDay) {  
                const startDateTime = new Date(`${startDate}T${startTime}`);  
                const endDateTime = new Date(`${endDate}T${endTime}`);  
                  
                // Si la hora de fin es anterior a la de inicio, asumimos que es al d√≠a siguiente  
                if (endDateTime <= startDateTime) {  
                    endDateTime.setDate(endDateTime.getDate() + 1);  
                }  
                  
                const diffMs = endDateTime - startDateTime;  
                const totalHours = Math.round((diffMs / (1000 * 60 * 60)) * 100) / 100;  
                  
                // Calcular horas normales vs extras  
                let normalHours = 0;  
                let overtimeNormal = 0;  
                let overtimeSpecial = 0;  
                let doubleDayApplied = false;
                  
                // Verificar si aplica d√≠a doble
                const shouldApplyDoubleDay = isDoubleDay && isDoubleDayEligible(startDate, isHoliday);
                  
                // Si es feriado o domingo, todas las horas son extras especiales (o d√≠a doble si aplica)
                if (isHoliday || isHolidayDate(startDate) || isSunday(startDate)) {  
                    if (shouldApplyDoubleDay) {
                        // Aplicar d√≠a doble - las primeras 9 horas se pagan como d√≠a doble
                        if (totalHours <= DOUBLE_DAY_HOURS) {
                            doubleDayApplied = true;
                        } else {
                            doubleDayApplied = true;
                            overtimeSpecial = totalHours - DOUBLE_DAY_HOURS;
                        }
                    } else {
                        // Horas extras especiales normales
                        overtimeSpecial = totalHours;
                    }
                    
                    return {   
                        totalHours,   
                        normalHours: 0,   
                        overtimeHours: { normal: 0, special: overtimeSpecial },
                        doubleDayApplied
                    };  
                }  
                  
                // Obtener el horario laboral seg√∫n el grupo seleccionado  
                const schedule = WORK_SCHEDULES[workGroup];  
                  
                // Para calcular distribuci√≥n de horas entre normales y extras  
                let currentTime = new Date(startDateTime);  
                
                // Ajustar para manejar correctamente los periodos que cruzan d√≠as
                while (currentTime < endDateTime) {  
                    const segmentEnd = new Date(currentTime);  
                    segmentEnd.setHours(segmentEnd.getHours() + 1);  
                    
                    if (segmentEnd > endDateTime) {  
                        segmentEnd.setTime(endDateTime.getTime());  
                    }  
                    
                    const hourDuration = (segmentEnd - currentTime) / (1000 * 60 * 60);  
                    const dayOfWeek = currentTime.getDay();  
                    const hourOfDay = currentTime.getHours();  
                      
                    // Determinar si es d√≠a laboral  
                    const isWeekday = dayOfWeek >= 1 && dayOfWeek <= 5; // Lunes a Viernes  
                    const isSaturday = dayOfWeek === 6; // S√°bado  
                      
                    // Obtener el horario correspondiente al d√≠a  
                    let daySchedule = null;  
                    if (isWeekday) {  
                        daySchedule = schedule.weekday;  
                    } else if (isSaturday) {  
                        daySchedule = schedule.saturday;  
                    }  
                      
                    // Verificar si la hora actual est√° dentro del horario laboral  
                    let isWithinSchedule = false;  
                      
                    if (daySchedule) {  
                        isWithinSchedule = hourOfDay >= daySchedule.start && hourOfDay < daySchedule.end;  
                    }  
                      
                    if (isWithinSchedule) {  
                        // Hora normal  
                        normalHours += hourDuration;  
                    } else {  
                        // Hora extra - determinar si es normal o especial  
                        if (isSaturday) {  
                            // Para s√°bado, depende de si es antes o despu√©s del turno  
                            if (hourOfDay < daySchedule.start) {  
                                // Antes del inicio del turno del s√°bado - hora extra normal  
                                overtimeNormal += hourDuration;  
                            } else if (hourOfDay >= daySchedule.end) {  
                                // Despu√©s del turno del s√°bado - hora extra especial  
                                overtimeSpecial += hourDuration;  
                            }  
                        } else if (dayOfWeek === 0) {  
                            // Domingo - todas las horas son extras especiales  
                            overtimeSpecial += hourDuration;  
                        } else {  
                            // Lunes a Viernes fuera de horario - hora extra normal  
                            overtimeNormal += hourDuration;  
                        }  
                    }  
                      
                    currentTime = segmentEnd;  
                }  
                  
                return {   
                    totalHours,   
                    normalHours: Math.round(normalHours * 100) / 100,   
                    overtimeHours: {   
                        normal: Math.round(overtimeNormal * 100) / 100,   
                        special: Math.round(overtimeSpecial * 100) / 100   
                    },
                    doubleDayApplied
                };  
            }
            
            function isSunday(dateString) {
                const date = new Date(dateString);
                return date.getDay() === 0;
            }
              
            function isHolidayDate(dateString) {  
                return GUATEMALA_HOLIDAYS.includes(dateString);  
            }  
              
            function getGroupName(groupKey) {  
                const groups = {  
                    'group1': 'Grupo 1',  
                    'group2': 'Grupo 2'  
                };  
                return groups[groupKey] || groupKey;  
            }  
              
            function saveSchedule(workGroup, startDate, endDate, startTime, endTime, totalHours, normalHours, overtimeHours, doubleDayApplied, doubleDayRate, normalAmount, specialAmount, doubleDayAmount, location, description, isHoliday, isDoubleDay) {  
                let schedules = JSON.parse(localStorage.getItem('workSchedules')) || [];  
                  
                schedules.push({  
                    workGroup,  
                    startDate,  
                    endDate,  
                    startTime,  
                    endTime,  
                    totalHours,  
                    normalHours,  
                    overtimeHours,  
                    doubleDayApplied,
                    doubleDayRate,
                    doubleDayAmount,
                    normalAmount,  
                    specialAmount,  
                    location,  
                    description,  
                    isHoliday,
                    isDoubleDay,
                    id: Date.now() // Agregar ID √∫nico para mejor manejo
                });  
                  
                localStorage.setItem('workSchedules', JSON.stringify(schedules));  
            }
            
            function updateSchedule(index, workGroup, startDate, endDate, startTime, endTime, totalHours, normalHours, overtimeHours, doubleDayApplied, doubleDayRate, normalAmount, specialAmount, doubleDayAmount, location, description, isHoliday, isDoubleDay) {
                let schedules = JSON.parse(localStorage.getItem('workSchedules')) || [];
                
                if (index >= 0 && index < schedules.length) {
                    schedules[index] = {
                        workGroup,  
                        startDate,  
                        endDate,  
                        startTime,  
                        endTime,  
                        totalHours,  
                        normalHours,  
                        overtimeHours,  
                        doubleDayApplied,
                        doubleDayRate,
                        doubleDayAmount,
                        normalAmount,  
                        specialAmount,  
                        location,  
                        description,  
                        isHoliday,
                        isDoubleDay,
                        id: schedules[index].id // Mantener el mismo ID
                    };
                    
                    localStorage.setItem('workSchedules', JSON.stringify(schedules));
                }
            }
            
            function editSchedule(index) {
                const schedules = JSON.parse(localStorage.getItem('workSchedules')) || [];
                
                if (index >= 0 && index < schedules.length) {
                    const schedule = schedules[index];
                    
                    // Llenar el formulario con los datos del registro
                    document.querySelector(`input[name="work-group"][value="${schedule.workGroup}"]`).checked = true;
                    document.getElementById('date').value = schedule.startDate;
                    document.getElementById('start-time').value = schedule.startTime;
                    document.getElementById('end-date').value = schedule.endDate;
                    document.getElementById('end-time').value = schedule.endTime;
                    document.getElementById('location').value = schedule.location;
                    document.getElementById('is-holiday').checked = schedule.isHoliday;
                    document.getElementById('is-double-day').checked = schedule.isDoubleDay;
                    document.getElementById('double-day-rate').value = schedule.doubleDayRate || DEFAULT_DOUBLE_DAY_RATE.toFixed(2);
                    document.getElementById('description').value = schedule.description || '';
                    
                    // Mostrar u ocultar campos de d√≠a doble seg√∫n corresponda
                    if (schedule.isDoubleDay) {
                        doubleDayInfo.style.display = 'block';
                        doubleDayRateGroup.style.display = 'block';
                    } else {
                        doubleDayInfo.style.display = 'none';
                        doubleDayRateGroup.style.display = 'none';
                    }
                    
                    // Cambiar a modo edici√≥n
                    isEditing = true;
                    editingIndex = index;
                    document.querySelector('button[type="submit"]').textContent = 'Actualizar Registro';
                    
                    // Scroll al formulario
                    document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
                    
                    showToast('Modo edici√≥n activado. Modifica los datos y haz clic en Actualizar.', 'success');
                }
            }
            
            function cancelEdit() {
                isEditing = false;
                editingIndex = -1;
                document.querySelector('button[type="submit"]').textContent = 'Guardar y Calcular';
                
                // Limpiar formulario
                form.reset();
                
                // Establecer fechas por defecto
                const today = new Date();  
                const formattedDate = formatDateForInput(today);  
                document.getElementById('date').value = formattedDate;  
                document.getElementById('end-date').value = formattedDate;
                document.getElementById('double-day-rate').value = DEFAULT_DOUBLE_DAY_RATE.toFixed(2);
                
                // Ocultar campos de d√≠a doble
                doubleDayInfo.style.display = 'none';
                doubleDayRateGroup.style.display = 'none';
                
                showToast('Edici√≥n cancelada.', 'success');
            }
              
            function loadHistory() {  
                const schedules = JSON.parse(localStorage.getItem('workSchedules')) || [];  
                  
                historyTable.innerHTML = '';  
                  
                schedules.forEach((schedule, index) => {  
                    addToHistoryTable(  
                        index,
                        schedule.workGroup,  
                        schedule.startDate,  
                        schedule.endDate,  
                        schedule.startTime,  
                        schedule.endTime,  
                        schedule.totalHours,  
                        schedule.normalHours,  
                        schedule.overtimeHours.normal + schedule.overtimeHours.special,   
                        schedule.doubleDayApplied ? 'S√≠' : 'No',
                        schedule.normalAmount + schedule.specialAmount + (schedule.doubleDayAmount || 0),  
                        schedule.location,  
                        schedule.isHoliday  
                    );  
                });  
            }  
              
            function addToHistoryTable(index, workGroup, startDate, endDate, startTime, endTime, totalHours, normalHours, overtime, doubleDay, amount, location, isHoliday) {  
                const row = document.createElement('tr');  
                  
                const groupName = getGroupName(workGroup);  
                const groupClass = workGroup.includes('group1') ? 'group1' : 'group2';  
                  
                row.innerHTML = `  
                    <td class="${groupClass}">${groupName}</td>  
                    <td>${startDate}</td>  
                    <td>${endDate}</td>  
                    <td>${startTime}</td>  
                    <td>${endTime}</td>  
                    <td>${totalHours.toFixed(2)}</td>  
                    <td class="regular-hours">${normalHours.toFixed(2)}</td>  
                    <td style="color: ${overtime > 0 ? '#3498db' : 'inherit'}">  
                        ${overtime > 0 ? overtime.toFixed(2) : '0'}  
                    </td>  
                    <td style="color: ${doubleDay === 'S√≠' ? '#ff6b6b' : 'inherit'}">  
                        ${doubleDay}  
                    </td>  
                    <td>Q${amount.toFixed(2)}</td>  
                    <td>${location}</td>  
                    <td class="action-buttons">
                        <button class="button-warning edit-btn" data-index="${index}">Editar</button>
                        <button class="button-danger delete-btn" data-index="${index}">Eliminar</button>
                    </td>  
                `;  
                  
                historyTable.appendChild(row);  
                  
                // Agregar evento al bot√≥n de eliminar  
                row.querySelector('.delete-btn').addEventListener('click', function() {  
                    const indexToDelete = parseInt(this.getAttribute('data-index'));  
                    deleteSchedule(indexToDelete);  
                });
                
                // Agregar evento al bot√≥n de editar
                row.querySelector('.edit-btn').addEventListener('click', function() {
                    const indexToEdit = parseInt(this.getAttribute('data-index'));
                    editSchedule(indexToEdit);
                });  
            }  
              
            function deleteSchedule(index) {  
                if (confirm('¬øEst√°s seguro de que deseas eliminar este registro?')) {
                    let schedules = JSON.parse(localStorage.getItem('workSchedules')) || [];  
                    schedules.splice(index, 1);  
                    localStorage.setItem('workSchedules', JSON.stringify(schedules));  
                    loadHistory();  
                    updateOvertimeSummary();
                    showToast('Registro eliminado correctamente.', 'success');
                    
                    // Si est√°bamos editando este registro, cancelar edici√≥n
                    if (isEditing && editingIndex === index) {
                        cancelEdit();
                    }
                }  
            }
            
            function clearHistory() {
                if (confirm('¬øEst√°s seguro de que deseas eliminar todo el historial? Esta acci√≥n no se puede deshacer.')) {
                    localStorage.removeItem('workSchedules');
                    loadHistory();
                    updateOvertimeSummary();
                    showToast('Historial limpiado correctamente.', 'success');
                    
                    // Si est√°bamos editando, cancelar edici√≥n
                    if (isEditing) {
                        cancelEdit();
                    }
                }
            }
            
            function exportToCSV() {
                const schedules = JSON.parse(localStorage.getItem('workSchedules')) || [];
                
                if (schedules.length === 0) {
                    showToast('No hay datos para exportar.', 'error');
                    return;
                }
                
                // Encabezados CSV
                let csvContent = "Grupo,Fecha Inicio,Fecha Fin,Hora Inicio,Hora Fin,Horas Totales,Horas Normales,Horas Extras Normales,Horas Extras Especiales,D√≠a Doble,Monto D√≠a Doble,Monto Extras Normales,Monto Extras Especiales,Total,Ubicaci√≥n,Es Festivo,Descripci√≥n\n";
                
                // Datos
                schedules.forEach(schedule => {
                    const row = [
                        getGroupName(schedule.workGroup),
                        schedule.startDate,
                        schedule.endDate,
                        schedule.startTime,
                        schedule.endTime,
                        schedule.totalHours,
                        schedule.normalHours,
                        schedule.overtimeHours.normal,
                        schedule.overtimeHours.special,
                        schedule.doubleDayApplied ? 'S√≠' : 'No',
                        schedule.doubleDayAmount || 0,
                        schedule.normalAmount,
                        schedule.specialAmount,
                        (schedule.normalAmount + schedule.specialAmount + (schedule.doubleDayAmount || 0)).toFixed(2),
                        `"${schedule.location}"`, // Entre comillas por si contiene comas
                        schedule.isHoliday ? 'S√≠' : 'No',
                        `"${schedule.description || ''}"`
                    ];
                    
                    csvContent += row.join(',') + '\n';
                });
                
                // Crear blob y descargar
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                const date = new Date().toISOString().slice(0, 10);
                
                link.setAttribute("href", url);
                link.setAttribute("download", `horas_extras_${date}.csv`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showToast('Datos exportados correctamente.', 'success');
            }
            
            function showToast(message, type = '') {
                toast.textContent = message;
                toast.className = 'toast';
                
                if (type) {
                    toast.classList.add(type);
                }
                
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
            
            function updateRealTimePreview() {
                const workGroup = document.querySelector('input[name="work-group"]:checked')?.value;  
                const startDate = document.getElementById('date').value;  
                const startTime = document.getElementById('start-time').value;  
                let endDate = document.getElementById('end-date').value;  
                const endTime = document.getElementById('end-time').value;  
                const isHoliday = document.getElementById('is-holiday').checked;
                const isDoubleDay = document.getElementById('is-double-day').checked;
                const doubleDayRate = parseFloat(document.getElementById('double-day-rate').value) || DEFAULT_DOUBLE_DAY_RATE;
                
                // Validar que tenemos los campos necesarios
                if (!workGroup || !startDate || !startTime || !endTime) {
                    return;
                }
                
                // Si no hay fecha de fin, usar la de inicio
                if (!endDate) {
                    endDate = startDate;
                }
                
                try {
                    // Calcular horas
                    const { normalHours, overtimeHours, doubleDayApplied } = calculateHours(  
                        workGroup, startDate, startTime, endDate, endTime, isHoliday, isDoubleDay  
                    );
                    
                    // Calcular montos
                    const normalAmount = overtimeHours.normal * NORMAL_OVERTIME_RATE;  
                    const specialAmount = overtimeHours.special * SPECIAL_OVERTIME_RATE;  
                    const doubleDayAmount = doubleDayApplied ? doubleDayRate : 0;
                    const totalAmount = normalAmount + specialAmount + doubleDayAmount;
                    
                    // Actualizar previsualizaci√≥n
                    document.getElementById('preview-normal').textContent = normalHours.toFixed(2);
                    document.getElementById('preview-normal-ot').textContent = overtimeHours.normal.toFixed(2);
                    document.getElementById('preview-special-ot').textContent = overtimeHours.special.toFixed(2);
                    document.getElementById('preview-double-day').textContent = doubleDayApplied ? `S√≠ (Q${doubleDayAmount.toFixed(2)})` : 'No aplica';
                    document.getElementById('preview-total').textContent = totalAmount.toFixed(2);
                } catch (e) {
                    console.error('Error en previsualizaci√≥n:', e);
                }
            }
              
            function updateOvertimeSummary() {  
                const schedules = JSON.parse(localStorage.getItem('workSchedules')) || [];  
                  
                let totalNormalHours = 0;  
                let normalOvertime = 0;  
                let normalAmount = 0;  
                  
                let specialOvertime = 0;  
                let specialAmount = 0;  
                
                let doubleDayCount = 0;
                let doubleDayAmount = 0;
                  
                schedules.forEach(schedule => {  
                    totalNormalHours += schedule.normalHours;  
                    normalOvertime += schedule.overtimeHours.normal;  
                    normalAmount += schedule.normalAmount;  
                      
                    specialOvertime += schedule.overtimeHours.special;  
                    specialAmount += schedule.specialAmount;  
                    
                    if (schedule.doubleDayApplied) {
                        doubleDayCount++;
                        doubleDayAmount += schedule.doubleDayAmount || 0;
                    }
                });  
                  
                // Actualizar la interfaz  
                document.getElementById('normal-hours').textContent = totalNormalHours.toFixed(2) + ' horas';  
                document.getElementById('normal-overtime').textContent = normalOvertime.toFixed(2) + ' horas';  
                document.getElementById('normal-amount').textContent = 'Q' + normalAmount.toFixed(2);  
                  
                document.getElementById('special-overtime').textContent = specialOvertime.toFixed(2) + ' horas';  
                document.getElementById('special-amount').textContent = 'Q' + specialAmount.toFixed(2);  
                
                document.getElementById('double-day-count').textContent = doubleDayCount + ' d√≠as';  
                document.getElementById('double-day-amount').textContent = 'Q' + doubleDayAmount.toFixed(2);
                  
                // Calcular total  
                const totalAmount = normalAmount + specialAmount + doubleDayAmount;  
                document.getElementById('total-amount').textContent = 'Q' + totalAmount.toFixed(2);  
            }  
        });  
    </script>

</body>  
</html>
